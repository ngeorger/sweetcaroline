jQuery(function(i){"use strict";var e={getAddonOptions:function(){var a={security:blv_cust_p_params.nonce.get_addon_options,action:"blv_cust_p_get_addon_options"};return i.ajax({type:"POST",data:a,url:blv_cust_p_params.ajax_url})},getAddonField:function(){var a={security:blv_cust_p_params.nonce.get_addon_field,action:"blv_cust_p_get_addon_field"};return i.ajax({type:"POST",data:a,url:blv_cust_p_params.ajax_url})},refresh:function(){0<i(".blv-cust-p-addon").length?(i(".blv-cust-p-toolbar").addClass("blv-cust-p-has-addons"),i(".blv-cust-p-addons").addClass("blv-cust-p-has-addons")):(i(".blv-cust-p-toolbar").removeClass("blv-cust-p-has-addons"),i(".blv-cust-p-addons").removeClass("blv-cust-p-has-addons")),i(document.body).trigger("init_tooltips")},expandAllFields:function(){i("#product_addons_data .blv-cust-p-addon").removeClass("closed").addClass("open")},closeAllFields:function(){i("#product_addons_data .blv-cust-p-addon").removeClass("open").addClass("closed")},addonRowIndexes:function(){i(".blv-cust-p-addons .blv-cust-p-addon").each(function(a,o){i(".blv-cust-p-addon-position",o).val(parseInt(i(o).index(".blv-cust-p-addons .blv-cust-p-addon")))})},runFieldSortable:function(){i(".blv-cust-p-addons").sortable({items:".blv-cust-p-addon",cursor:"move",axis:"y",handle:".blv-cust-p-addon-header",scrollSensitivity:40,helper:function(a,o){return o},start:function(a,o){o.item.css("border-style","dashed").css("border-color","orange")},stop:function(a,o){o.item.removeAttr("style"),e.addonRowIndexes()}})},runOptionSortable:function(){i(".blv-cust-p-addon-content-options-container").sortable({items:".blv-cust-p-addon-option-row",cursor:"move",axis:"y",handle:".blv-cust-p-addon-sort-handle",scrollSensitivity:40,helper:function(a,o){return o},start:function(a,o){o.item.css("border-style","dashed").css("border-width","1px").css("border-color","orange")},stop:function(a,o){o.item.removeAttr("style"),e.addonRowIndexes()}})},validateSettings:function(a){i(".blv-cust-p-error-message").remove(),i(".updated").remove();var d=!0,e=!0;if(i(".blv-cust-p-addons").find(".blv-cust-p-addon").each(function(a){0===i(this).find(".blv-cust-p-addon-content-name").val().length?(i(this).addClass("blv-cust-p-error").find(".blv-cust-p-addon-content-name").addClass("blv-cust-p-error"),e=d=!1):i(this).find(".blv-cust-p-addon-content-name").removeClass("blv-cust-p-error");var o=i(this).find(".blv-cust-p-addon-type-select").val();i(this).find(".blv-cust-p-addon-option-row").each(function(){"multiple_choice"!==o&&"checkbox"!==o||0!==i(this).find(".blv-cust-p-addon-content-label input").val().length?i(this).find(".blv-cust-p-addon-content-label input").removeClass("blv-cust-p-error"):(i(this).find(".blv-cust-p-addon-content-label input").addClass("blv-cust-p-error"),i(this).parents(".blv-cust-p-addon").eq(0).addClass("blv-cust-p-error"),e=d=!1)}),e&&i(this).removeClass("blv-cust-p-error")}),!1===d){var o=i('<div class="notice notice-error blv-cust-p-error-message"><p>'+blv_cust_p_params.i18n.required_fields+"</p></div>");"product"===a?i(".blv-cust-p-addons").before(o):"global"===a&&i(".global-addons-form").before(o),i("html, body").animate({scrollTop:i(".blv-cust-p-error-message").offset().top-200},600)}return d},init:function(){i(".post-type-product").on("click",'#publishing-action input[name="save"]',function(){return e.validateSettings("product")}),i(".product_page_addons").on("click",'input[type="submit"]',function(){return e.validateSettings("global")}),i("#product_addons_data").on("change",".blv-cust-p-addon-content-name",function(){i(this).val()?i(this).closest(".blv-cust-p-addon").find(".blv-cust-p-addon-name").text(i(this).val()):i(this).closest(".blv-cust-p-addon").find(".blv-cust-p-addon-name").text("")}).on("keyup",".blv-cust-p-addon-content-name, .blv-cust-p-addon-content-label input",function(){i(this).removeClass("blv-cust-p-error"),i(".blv-cust-p-error-message").remove()}).on("change","select.blv-cust-p-addon-type-select",function(a){var o,d=i(this).val(),e=i(this).parents(".blv-cust-p-addon"),n=a.target.selectedOptions[0].innerHTML;switch(e.find(".blv-cust-p-addon-header .blv-cust-p-addon-type").html(n),e.find(".blv-cust-p-addon-main-settings-2 .blv-cust-p-col1").removeClass("full"),e.find(".blv-cust-p-addon-main-settings-2 .blv-cust-p-col2").removeClass("hide").addClass("show"),e.find(".blv-cust-p-addon-content-image").removeClass("show").addClass("hide"),e.find(".blv-cust-p-addon-content-label").addClass("full"),e.find(".blv-cust-p-addon-restrictions-select").removeClass("show").addClass("hide"),e.find(".blv-cust-p-addon-main-settings-1 .blv-cust-p-col2-1").removeClass("show").addClass("hide"),e.find(".blv-cust-p-addon-main-settings-1 .blv-cust-p-col2-2").removeClass("show").addClass("hide"),e.find(".blv-cust-p-addon-main-settings-1 .blv-cust-p-col1").addClass("full"),e.find(".blv-cust-p-addon-content-option-rows").removeClass("show").addClass("hide"),e.find(".blv-cust-p-addon-content-non-option-rows").removeClass("hide").addClass("show"),e.find(".blv-cust-p-addon-required-setting").removeClass("hide").addClass("show"),d){case"multiple_choice":e.find(".blv-cust-p-addon-main-settings-1 .blv-cust-p-col2-1").removeClass("hide").addClass("show"),e.find(".blv-cust-p-addon-main-settings-1 .blv-cust-p-col1").removeClass("full"),e.find(".blv-cust-p-addon-content-option-rows").removeClass("hide").addClass("show"),e.find(".blv-cust-p-addon-content-non-option-rows").removeClass("show").addClass("hide"),"images"===e.find(".blv-cust-p-addon-display-select").val()&&(e.find(".blv-cust-p-addon-content-image").removeClass("hide").addClass("show"),e.find(".blv-cust-p-addon-content-label").removeClass("full"));break;case"checkbox":e.find(".blv-cust-p-addon-main-settings-1 .blv-cust-p-col2-1").removeClass("show").addClass("hide"),e.find(".blv-cust-p-addon-main-settings-1 .blv-cust-p-col1").addClass("full"),e.find(".blv-cust-p-addon-content-option-rows").removeClass("hide").addClass("show"),e.find(".blv-cust-p-addon-content-non-option-rows").removeClass("show").addClass("hide"),e.find(".blv-cust-p-addon-content-image").removeClass("show").addClass("hide"),e.find(".blv-cust-p-addon-content-label").addClass("full"),e.find(".blv-cust-p-addon-adjust-price-container").removeClass("show").addClass("hide"),e.find(".blv-cust-p-addon-restrictions-container").removeClass("show").addClass("hide");break;case"custom_price":o=blv_cust_p_params.i18n.limit_price_range,e.find(".blv-cust-p-addon-adjust-price-container").removeClass("show").addClass("hide"),e.find(".blv-cust-p-addon-min-max").removeClass("hide").addClass("show"),e.find(".blv-cust-p-addon-main-settings-1 .blv-cust-p-col2-1").removeClass("show").addClass("hide"),e.find(".blv-cust-p-addon-main-settings-1 .blv-cust-p-col1").addClass("full"),e.find(".blv-cust-p-addon-content-option-rows").removeClass("show").addClass("hide"),e.find(".blv-cust-p-addon-content-non-option-rows").removeClass("hide").addClass("show"),e.find(".blv-cust-p-addon-restrictions-select").removeClass("show").addClass("hide"),e.find(".blv-cust-p-addon-adjust-price-container").removeClass("show").addClass("hide"),e.find(".blv-cust-p-addon-restrictions-container").removeClass("hide").addClass("show");break;case"input_multiplier":e.find(".blv-cust-p-addon-adjust-price-container").removeClass("hide").addClass("show"),e.find(".blv-cust-p-addon-restrictions-container").removeClass("hide").addClass("show"),o=blv_cust_p_params.i18n.limit_quantity_range;break;case"custom_text":o=blv_cust_p_params.i18n.limit_character_length,e.find(".blv-cust-p-addon-main-settings-1 .blv-cust-p-col2-2").removeClass("hide").addClass("show"),e.find(".blv-cust-p-addon-restrictions-select").removeClass("hide").addClass("show"),e.find(".blv-cust-p-addon-content-option-rows").removeClass("show").addClass("hide"),e.find(".blv-cust-p-addon-content-non-option-rows").removeClass("hide").addClass("show"),e.find(".blv-cust-p-addon-adjust-price-container").removeClass("hide").addClass("show"),e.find(".blv-cust-p-addon-restrictions-container").removeClass("hide").addClass("show"),e.find(".blv-cust-p-addon-min-max").removeClass("hide").addClass("show"),"email"===e.find(".blv-cust-p-addon-restrictions-select").val()&&e.find(".blv-cust-p-addon-min-max").removeClass("show").addClass("hide");break;case"custom_textarea":o=blv_cust_p_params.i18n.limit_character_length,e.find(".blv-cust-p-addon-min-max").removeClass("hide").addClass("show"),e.find(".blv-cust-p-addon-adjust-price-container").removeClass("hide").addClass("show"),e.find(".blv-cust-p-addon-restrictions-container").removeClass("hide").addClass("show");break;case"file_upload":e.find(".blv-cust-p-addon-adjust-price-container").removeClass("hide").addClass("show"),e.find(".blv-cust-p-addon-restrictions-container").removeClass("show").addClass("hide");break;case"heading":e.find(".blv-cust-p-addon-required-setting").removeClass("show").addClass("hide"),e.find(".blv-cust-p-addon-adjust-price-container").removeClass("show").addClass("hide"),e.find(".blv-cust-p-addon-restrictions-container").removeClass("show").addClass("hide"),e.find(".blv-cust-p-addon-main-settings-2 .blv-cust-p-col1").addClass("full"),e.find(".blv-cust-p-addon-main-settings-2 .blv-cust-p-col2").removeClass("show").addClass("hide");break;default:e.find(".blv-cust-p-addon-main-settings-1 .blv-cust-p-col2-1").removeClass("show").addClass("hide"),e.find(".blv-cust-p-addon-main-settings-1 .blv-cust-p-col2-2").removeClass("show").addClass("hide"),e.find(".blv-cust-p-addon-main-settings-1 .blv-cust-p-col1").addClass("full"),e.find(".blv-cust-p-addon-content-option-rows").removeClass("show").addClass("hide"),e.find(".blv-cust-p-addon-content-non-option-rows").removeClass("hide").addClass("show"),o=blv_cust_p_params.i18n.restrictions,e.find(".blv-cust-p-addon-restrictions-container").removeClass("show").addClass("hide")}e.find(".blv-cust-p-addon-restriction-name").html(o);var s=i(this).closest(".blv-cust-p-addon").find(".blv-cust-p-remove-option");s.length<2?s.attr("disabled","disabled"):s.removeAttr("disabled")}).on("change",".blv-cust-p-addon-display-select",function(){var a=i(this).val(),o=i(this).parents(".blv-cust-p-addon");"images"===a?(o.find(".blv-cust-p-addon-content-image").removeClass("hide").addClass("show"),o.find(".blv-cust-p-addon-content-label").removeClass("full")):(o.find(".blv-cust-p-addon-content-image").removeClass("show").addClass("hide"),o.find(".blv-cust-p-addon-content-label").addClass("full"))}).on("click","button.blv-cust-p-add-option",function(){var o=i(this).closest(".blv-cust-p-addon").index(".blv-cust-p-addon"),d=i(this).parents(".blv-cust-p-addon-content-option-rows").find(".blv-cust-p-addon-content-options-container");return i.when(e.getAddonOptions()).then(function(a){a=(a=a.html).replace(/{loop}/g,o),"images"===i(this).parents(".blv-cust-p-addon").find(".blv-cust-p-addon-display-select").val()&&(a=(a=a.replace(/blv-cust-p-addon-content-image hide/g,"blv-cust-p-addon-content-image show")).replace(/blv-cust-p-addon-content-label full/g,"blv-cust-p-addon-content-label")),i(a).appendTo(d),i("select.blv-cust-p-addon-type-select").change()}),!1}).on("click",".blv-cust-p-add-field",function(){var d=i(".blv-cust-p-addons .blv-cust-p-addon").length;return i.when(e.getAddonField()).then(function(a){a=(a=(a=a.html).replace(/{loop}/g,d)).replace(/closed/g,"open"),i(".blv-cust-p-addons").append(a),i("select.blv-cust-p-addon-type-select").change(),e.refresh(),e.runOptionSortable();var o=i("select#product-type").val();i(".hide_if_"+o).hide(),i(".show_if_"+o).show()}),!1}).on("click",".blv-cust-p-remove-addon",function(){if(i(".blv-cust-p-error-message").remove(),confirm(blv_cust_p_params.i18n.confirm_remove_addon)){var a=i(this).closest(".blv-cust-p-addon");i(a).find("input").val(""),i(a).remove()}return i(".blv-cust-p-addons .blv-cust-p-addon").each(function(a,o){var d=a;i(this).find(".product_addon_position").val(d),i(this).find("select, input, textarea").prop("name",function(a,o){return o.replace(/\[[0-9]+\]/g,"["+d+"]")})}),e.refresh(),!1}).on("click",".blv-cust-p-remove-option",function(){if(confirm(blv_cust_p_params.i18n.confirm_remove_option)){var a=i(this).parents(".blv-cust-p-addon-content").find("select.blv-cust-p-addon-type-select");i(this).parents(".blv-cust-p-addon-option-row").remove(),a.change()}return!1}).on("click",".blv-cust-p-expand-all",function(a){a.preventDefault(),e.expandAllFields()}).on("click",".blv-cust-p-close-all",function(a){a.preventDefault(),e.closeAllFields()}).on("click",".blv-cust-p-addon-header",function(a){a.preventDefault();var o=i(this).parents(".blv-cust-p-addon");o.hasClass("open")?o.removeClass("open").addClass("closed"):o.removeClass("closed").addClass("open")}).on("click",".blv-cust-p-addon-description-enable",function(){i(this).is(":checked")?i(this).parents(".blv-cust-p-addons-secondary-settings").find(".blv-cust-p-addon-description").removeClass("hide").addClass("show"):i(this).parents(".blv-cust-p-addons-secondary-settings").find(".blv-cust-p-addon-description").removeClass("show").addClass("hide")}).on("change",".blv-cust-p-addon-option-price-type",function(){switch(i(this).val()){case"flat_fee":case"quantity_based":i(this).parents(".blv-cust-p-addon-content-price-type").removeClass("full").next(".blv-cust-p-addon-content-price").eq(0).removeClass("hide").addClass("show")}}).on("click",".blv-cust-p-addon-add-image",function(){var a,d=i(this).parent();(a=wp.media.frames.mediaFrame=wp.media({title:blv_cust_p_params.i18n.add_image_swatch,button:{text:blv_cust_p_params.i18n.add_image},library:{type:"image"},multiple:!1})).on("select",function(){a.state().get("selection").map(function(a){if((a=a.toJSON()).id){var o=a.sizes.thumbnail?a.sizes.thumbnail.url:a.url;d.find(".blv-cust-p-addon-option-image-id").val(a.id),d.find(".blv-cust-p-addon-image-swatch img").prop("src",o),d.find(".blv-cust-p-addon-image-swatch").removeClass("hide").addClass("show"),d.find(".blv-cust-p-addon-add-image").removeClass("show").addClass("hide"),d.find(".dashicons-plus").removeClass("show").addClass("hide")}})}),a.open()}).on("click",".blv-cust-p-addon-image-swatch",function(a){a.preventDefault();var o=i(this).parent();o.find(".blv-cust-p-addon-option-image-id").val(""),o.find(".blv-cust-p-addon-image-swatch img").prop("src",""),o.find(".blv-cust-p-addon-image-swatch").removeClass("show").addClass("hide"),o.find(".blv-cust-p-addon-add-image").removeClass("hide").addClass("show"),o.find(".dashicons-plus").removeClass("hide").addClass("show")}).on("click",".blv-cust-p-addon-restrictions",function(){i(this).is(":checked")?i(this).parents(".blv-cust-p-addon-restrictions-container").find(".blv-cust-p-addon-restrictions-settings").removeClass("hide").addClass("show"):i(this).parents(".blv-cust-p-addon-restrictions-container").find(".blv-cust-p-addon-restrictions-settings").removeClass("show").addClass("hide")}).on("change",".blv-cust-p-addon-restrictions-select",function(){var a=i(this).val(),o=i(this).parents(".blv-cust-p-addon-restrictions-settings");"email"===a?o.find(".blv-cust-p-addon-min-max").removeClass("show").addClass("hide"):o.find(".blv-cust-p-addon-min-max").removeClass("hide").addClass("show")}).on("click",".blv-cust-p-addon-adjust-price",function(){i(this).is(":checked")?i(this).parents(".blv-cust-p-addon-adjust-price-container").find(".blv-cust-p-addon-adjust-price-settings").removeClass("hide").addClass("show"):i(this).parents(".blv-cust-p-addon-adjust-price-container").find(".blv-cust-p-addon-adjust-price-settings").removeClass("show").addClass("hide")}).find("select.blv-cust-p-addon-type-select").change(),i("#product_addons_data").on("click",".blv-cust-p-export-addons",function(){return i("#product_addons_data textarea.blv-cust-p-import-field").hide(),i("#product_addons_data textarea.blv-cust-p-export-field").slideToggle("300",function(){i(this).select()}),!1}),i("#product_addons_data").on("click",".blv-cust-p-import-addons",function(){return i("#product_addons_data textarea.blv-cust-p-export-field").hide(),i("#product_addons_data textarea.blv-cust-p-import-field").slideToggle("300",function(){i(this).val("")}),!1}),e.runFieldSortable(),e.runOptionSortable(),1<i(".blv-cust-p-addons .blv-cust-p-addon").length&&i(".blv-cust-p-toolbar").show()}};e.init()});
